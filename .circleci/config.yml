version: 2.1
jobs:
  build:
    docker:
      - image: cimg/go:1.18

    steps:
      - checkout
      - run:
          name: Install dependencies
          command: go get ./...

      - run:
          name: Run tests
          command: |
            go test -v -coverprofile=coverage.out ./... | curl -sL https://github.com/mattn/goveralls/releases/latest/download/goveralls_linux_amd64.tar.gz | tar xvz
              ./goveralls -coverprofile=coverage.out -service=circle-ci -repotoken $brw
